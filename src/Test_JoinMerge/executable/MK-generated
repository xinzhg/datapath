# Makefile template to compile the generated code
# asumes that make is called like this:
# make -f MK-generaged -DOBJECTS="WP1.O ..." 
# The macro OBJECTS must list the objects needed

# COMPILER SELECTION
CC=g++
#CC=/opt/intel/Compiler/11.1/056/bin/intel64/icc

CCFLAGS = -fPIC -g -D_FILE_OFFSET_BITS=64

#CCFLAGS += -DSLOW_MAP_DSTRING

# COMPILER OPTIMIZATION
#OPT=-O3 -msse4a -ffast-math

M4=m4 

M4INCLUDES = -I ../../M4/m4 
M4INCLUDES += -I ../../WPFunctionModules 
M4INCLUDES += -I .

#CINCLUDES = -I ../../../HeadersdpLemon


# to preserve the generated cc files we need this
.PRECIOUS: %.cc

#JoinMergeWorkFuncs:
#	$(M4) $(M4INCLUDES) ../../WPFunctionModules/JoinMergeWorkFuncs.m4 > JoinMergeWorkFuncs
%.cc: %.m4
	$(M4) $(M4INCLUDES) $< > $@

#JoinMergeWorkFuncs.o: JoinMergeWorkFuncs
#	$(CC) $(CINCLUDES) $(CCFLAGS) $(OPT) -c -o JoinMergeWorkFuncs.o
%.o: %.cc
	$(CC) $(CINCLUDES) $(CCFLAGS) $(OPT) -c -o $@ $^

Generated.so: ${OBJECTS}
	${CC} ${OPT} -shared  -o Generated.so   ${OBJECTS}
